var Modularity=Modularity||{};!function(t){t('input[type="checkbox"].sidebar-area-activator').on("click",function(o){var i=t(this).is(":checked"),e=t(this).attr("value");o.shiftKey&&(i?t('input.sidebar-area-activator[type="checkbox"][value="'+e+'"]').attr("checked",!0):t('input.sidebar-area-activator[type="checkbox"][value="'+e+'"]').attr("checked",!1))})}(jQuery),function(t){t("#modularity-options #publish").on("click",function(){t(this).siblings(".spinner").css("visibility","visible")}),t('a.wp-first-item[href="admin.php?page=modularity"]').parent("li").remove(),t("#modularity-tabs a").on("click",function(o){return wp.autosave&&(t(window).unbind(),wp.autosave.server.triggerSave(),t(document).ajaxComplete(function(){return!0})),!0})}(jQuery),jQuery(document).ready(function(t){if(t("#modularity-mb-modules").length){var o=t("#modularity-mb-modules").offset();t(document).scroll(function(){t(window).scrollTop()+50>o.top&&!t("#modularity-mb-modules").hasClass("is-fixed")?t("#modularity-mb-modules").addClass("is-fixed"):t(window).scrollTop()+50<o.top&&t("#modularity-mb-modules").hasClass("is-fixed")&&t("#modularity-mb-modules").removeClass("is-fixed")})}t(".modularity-edit-module a").on("click",function(o){o.preventDefault(),Modularity.Editor.Thickbox.postAction="edit-inline-not-saved",Modularity.Prompt.Modal.open(t(o.target).closest("a").attr("href"))})}),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Autosave=function(t){function o(){t(function(){}.bind(this))}return o.prototype.save=function(o){t("#modularity-options #publishing-action .spinner").css("visibility","visible");var i=t(o).serializeObject();i.id=modularity_post_id,i.action="save_modules",t.post(ajaxurl,i,function(o){t("#modularity-options #publishing-action .spinner").css("visibility","hidden")})},new o}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.DragAndDrop=function(t){function o(){t(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&this.init()}.bind(this))}return o.prototype.init=function(){this.setupDraggable(),this.setupDroppable(),this.setupSortable()},o.prototype.setupSortable=function(){t(".modularity-js-sortable").sortable({handle:".modularity-sortable-handle",connectWith:".modularity-js-sortable",placeholder:"ui-sortable-placeholder",stop:function(o,i){var e=i.item.parents("ul").data("area-id");i.item.find('input[name^="modularity_modules"]').each(function(o,i){var a=t(this).attr("name").replace(/\[(.*?)\]/i,"["+e+"]");t(this).attr("name",a)})}}).bind(this)},o.prototype.setupDraggable=function(){t(".modularity-js-draggable").draggable({appendTo:"body",containment:"document",scroll:!1,helper:"clone",revert:"invalid",revertDuration:200})},o.prototype.setupDroppable=function(){t(".modularity-js-droppable").droppable({accept:".modularity-js-draggable",hoverClass:"modularity-state-droppable",drop:function(t,o){this.appendModule(t,o)}.bind(this)}).bind(this)},o.prototype.appendModule=function(t,o){var i=o.draggable,e=i.find(".modularity-module-name").text(),a=i.data("module-id");Modularity.Editor.Module.addModule(t.target,a,e)},new o}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Module=function(t){function o(){t(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&(this.handleEvents(),this.loadModules(modularity_post_id))}.bind(this))}var i={is_thickbox:!0},e=!1;return o.prototype.loadModules=function(o){var i={action:"get_post_modules",id:o};t.post(ajaxurl,i,function(o){t.each(o,function(o,i){var e=t('.modularity-sidebar-area[data-area-id="'+o+'"]');t.each(i.modules,function(t,o){this.addModule(e,o.post_type,o.post_type_name,o.post_title,o.ID,o.hidden,o.columnWidth,o.isDeprecated)}.bind(this)),e.removeClass("modularity-spinner")}.bind(this)),this.initCompleted=!0,t(".modularity-sidebar-area").removeClass("modularity-spinner")}.bind(this),"json")},o.prototype.isEditingModule=function(){return e},o.prototype.getThickBoxUrl=function(o,e){var a="",d={};switch(o){case"add":a="post-new.php";break;case"edit":a="post.php"}return"number"==typeof e.postId&&(d.post=e.postId,d.action="edit"),"string"==typeof e.postType&&(d.post_type=e.postType),admin_url+a+"?"+t.param(d)+"&"+t.param(i)},o.prototype.getImportUrl=function(o){var e="edit.php",a={};return a.post_type=o.postType,admin_url+e+"?"+t.param(a)+"&"+t.param(i)},o.prototype.addModule=function(o,i,e,a,d,r,n,l){a="undefined"!=typeof a?": "+a:"",d="undefined"!=typeof d?d:"",n="undefined"!=typeof n?n:"",deprecated=l===!0?'<span class="modularity-deprecated" style="color:#ff0000;">('+modularityAdminLanguage.deprecated+")</span>":"";var u=this.getThickBoxUrl("add",{postType:i});Modularity.Editor.Thickbox.postAction="add",d&&(u=this.getThickBoxUrl("edit",{postId:d}),Modularity.Editor.Thickbox.postAction="edit");var s=this.getImportUrl({postType:i}),p="";"true"==r&&(p="checked");var c=t(o).data("area-id"),m=Modularity.Helpers.uuid(),y=t(o)[0].innerHTML,y=y+'<li id="post-'+d+'" data-module-id="'+i+'" data-module-stored-width="'+n+'">                <span class="modularity-line-wrapper">                    <span class="modularity-sortable-handle"></span>                    <span class="modularity-module-name">                        '+e+"                        "+deprecated+'                        <span class="modularity-module-title">'+a+'</span>                        <label class="modularity-module-hide">                            <input type="hidden" name="modularity_modules['+c+"]["+m+'][hidden]" value="false" />                            <input type="checkbox" name="modularity_modules['+c+"]["+m+'][hidden]" value="true" '+p+" />                            "+modularityAdminLanguage.langhide+'                        </label>                    </span>                    <span class="modularity-module-columns">                        <label>'+modularityAdminLanguage.width+':</label>                        <select name="modularity_modules['+c+"]["+m+'][columnWidth]">                            '+modularityAdminLanguage.widthOptions+'                        </select>                    </span>                    <span class="modularity-module-actions">                        <a href="'+u+'" data-modularity-modal class="modularity-js-thickbox-open"><span>'+modularityAdminLanguage.langedit+'</span></a>                        <a href="'+s+'" class="modularity-js-thickbox-import"><span>'+modularityAdminLanguage.langimport+'</span></a>                        <a href="#remove" class="modularity-module-remove"><span>'+modularityAdminLanguage.langremove+'</span></a>                    </span>                    <input type="hidden" name="modularity_modules['+c+"]["+m+'][postid]" class="modularity-js-module-id" value="'+d+'" required>                </span>            </li>';t(o)[0].innerHTML=y,jQuery(".modularity-sidebar-area > li").each(function(o,i){t(".modularity-module-columns select",t(i)).val(t(i).attr("data-module-stored-width"))}),t(".modularity-js-sortable").sortable("refresh")},o.prototype.updateModule=function(t,o){t.find("a.modularity-js-thickbox-open").attr("href",this.getThickBoxUrl("edit",{postId:o.post_id})),t.find("input.modularity-js-module-id").val(o.post_id).change(),t.find(".modularity-module-title").text(": "+o.title)},o.prototype.removeModule=function(t){confirm(modularityAdminLanguage.actionRemove)&&t.remove()},o.prototype.handleEvents=function(){t(document).on("click",".modularity-module-remove",function(o){o.preventDefault();var i=t(o.target).closest("li");this.removeModule(i)}.bind(this)),t(document).on("click",".modularity-js-thickbox-import",function(o){o.preventDefault();t(o.target).closest("a");e=t(o.target).closest("li"),Modularity.Editor.Thickbox.postAction="import",Modularity.Prompt.Modal.open(t(o.target).closest("a").attr("href"))}),t(document).on("click",".modularity-js-thickbox-open",function(o){o.preventDefault();var i=t(o.target).closest("a");i.attr("href").indexOf("post.php")>-1&&(Modularity.Editor.Thickbox.postAction="edit"),e=t(o.target).closest("li"),Modularity.Prompt.Modal.open(t(o.target).closest("a").attr("href"))}.bind(this))},new o}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Thickbox=function(t){function o(){}return o.prototype.modulePostCreated=function(o){Modularity.Prompt.Modal.close();var i=Modularity.Editor.Module.isEditingModule(),e={action:"get_post",id:o};t.post(ajaxurl,e,function(t){var o={post_id:t.ID,title:t.post_title};Modularity.Editor.Module.updateModule(i,o),Modularity.Editor.Autosave.save("form")},"json")},new o}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Validate=function(t){function o(){this.handleEvents()}var i=!1,e="validation-error";return o.prototype.run=function(){i=!1,this.checkRequired()},o.prototype.checkRequired=function(){var o=t("[required]");o.removeClass(e),o.each(function(o,a){0===t(a).val().length&&(t(a).parents("li").addClass(e),t(a).one("change",function(o){t(o.target).parents("li").removeClass(e)}),i=!0)}.bind(this))},o.prototype.handleEvents=function(){t(document).on("click","#modularity-mb-editor-publish #publish",function(o){return this.run(),!i||(t("#modularity-mb-editor-publish .spinner").css("visibility","hidden"),!1)}.bind(this))},new o}(jQuery),Modularity=Modularity||{},Modularity.Helpers=Modularity.Helpers||{},Modularity.Helpers=function(t){function o(){t(function(){}.bind(this))}return o.prototype.uuid=function(t){return Math.random().toString(36).substr(2,9)},new o}(jQuery),jQuery.fn.serializeObject=function(){var t={},o=this.serializeArray();return jQuery.each(o,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},Modularity=Modularity||{},Modularity.Helpers=Modularity.Helpers||{},Modularity.Helpers.Widget=function(t){function o(){t(function(){t(document).on("click",".modularity-js-thickbox-widget-import-widget",function(o){o.preventDefault(),i=t(o.target).parents(".widget-inside");var e=Modularity.Editor.Module.getImportUrl({postType:t(o.target).parents(".widget-inside").find(".modularity-widget-module-type select").val()});Modularity.Editor.Module.editingModule=t(o.target).closest(".widget-inside"),Modularity.Editor.Thickbox.postAction="import-widget",Modularity.Prompt.Modal.open(e)}),t(document).on("click",".modularity-js-thickbox-open-widget",function(o){o.preventDefault();var i=t(o.target).closest("a");i.attr("href").indexOf("post.php")>-1&&(Modularity.Editor.Thickbox.postAction="edit"),editingModule=t(o.target).closest("li"),Modularity.Prompt.Modal.open(t(o.target).closest("a").attr("href"))}.bind(this))}.bind(this))}var i=!1;return o.prototype.isEditingWidget=function(){return i},o.prototype.updateWidget=function(o,i){t(o).find(".modularity-widget-module-id-span").html(i.post_id),t(o).find(".modularity-widget-module-id").val(i.post_id),t(o).find(".modularity-widget-module-edit").attr("href","post.php?post="+i.post_id+"&action=edit&is_thickbox=true").removeClass("hidden"),t(o).find(".modularity-widget-module-title-span").html(i.title),t(o).find(".modularity-widget-module-title").val(i.title)},new o}(jQuery),Modularity=Modularity||{},Modularity.Prompt=Modularity.Prompt||{},Modularity.Prompt.Modal=function(t){function o(){this.handleEvents()}var i=!1;return o.prototype.open=function(o){t("body").addClass("modularity-modal-open").append('            <div id="modularity-modal">                <div class="modularity-modal-wrapper">                    <button class="modularity-modal-close" data-modularity-modal-action="close">&times; '+modularityAdminLanguage.close+'</button>                    <iframe class="modularity-modal-iframe" src="'+o+'" frameborder="0" allowtransparency></iframe>                </div>            </div>        '),i=!0},o.prototype.close=function(){t("body").removeClass("modularity-modal-open"),t("#modularity-modal").remove(),i=!1},o.prototype.handleEvents=function(){t(document).on("click",'[data-modularity-modal-action="close"]',function(t){t.preventDefault(),this.close()}.bind(this))},new o}(jQuery);