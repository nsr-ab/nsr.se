var VcExtended=VcExtended||{};VcExtended.NSRExtend=VcExtended.NSRExtend||{},VcExtended.NSRExtend.Extended=function(e){function t(){this.init()}var a,o,n=null,r=200,s=[];return t.prototype.init=function(){t.prototype.DefaultSiteSearch(),e("body").hasClass("wp-admin")||e(".card-content").matchHeight(),e(function(){this.CollapsibleHeaders()}.bind(this)),e("body").on("click",".showAllPosts",function(){t.prototype.displayMore(this)}).bind(this),e("body").on("click",".searchArea *",function(e){t.prototype.fullScreen(e)}).bind(this),e("body").on("click",".closeSearch",function(e){t.prototype.closeScreen(this)}).bind(this),e.fn.enterKey=function(e){t.prototype.enterTrigger(e,this)},e(".searchNSR").enterKey(function(){event.preventDefault(),window.clearTimeout(n),t.prototype.doneTyping()}),e(".searchNSR").on("input",function(){window.clearTimeout(n),n=window.setTimeout(t.prototype.doneTyping,r)}),e(".searchNSR").on("keydown",function(e){t.prototype.haltTimer(e,n)}),e("body").on("click",".locationmap",function(){window.open(e(this).data("url"),"_blank")}).bind(this),e("body").on("click","#searchkeyword-nsr",function(){e("#searchkeyword-nsr").focus()}).bind(this)},t.prototype.DefaultSiteSearch=function(){var a=t.prototype.getUrlParameter("q");a&&(e("#searchkeyword-nsr").focus(),e("#searchkeyword-nsr").val(a.replace(/\+/g," ")),t.prototype.doneTyping())},t.prototype.CollapsibleHeaders=function(){e("body").on("click",".collapsible-header",function(){$id=e(this).parents("ul").attr("id"),0===e(this).find("a").length?(e($id).find(".materialIconState").text("add"),e(this).hasClass("active")?e(this).find(".materialIconState").text("remove"):e(this).find(".materialIconState").text("add")):window.location.href=e(this).find("a").attr("href")}).bind(this)},t.prototype.encodeStr=function(e){return e.split("").reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0)},t.prototype.displayMore=function(t){if(event.preventDefault(),e(t).closest("ul").find("li").hasClass("hide")){e(t).closest("ul").find(".hide").addClass("show"),e(t).closest("ul").find("li").removeClass("hide");var a=e(t).closest("ul").find("li").length-6;e(t).closest("ul").find(".showPosts").text("Dölj ("+a+")")}else{e(t).closest("ul").find(".show").addClass("hide"),e(t).closest("ul").find("li").removeClass("show");var o=e(t).closest("ul").find("li").length-1;e(t).closest("ul").find(".showPosts").text("Visa alla ("+o+")")}e(".card-content").matchHeight()},t.prototype.enterTrigger=function(t,a){return a.each(function(){e(a).keypress(function(o){var n=o.keyCode?o.keyCode:o.which;if("13"==n)return e(".search-autocomplete").remove(),e(".sorteringsguiden").remove(),t.call(a,o),event.preventDefault(),!1})})},t.prototype.haltTimer=function(e,t){switch(e.which){case 32:window.clearTimeout(t);break;case 8:window.clearTimeout(t)}},t.prototype.closeScreen=function(t){event.stopPropagation(),e(".searchNSR").removeClass("fullscreen"),e(".searchNSR").removeClass("searchResult"),e(t).addClass("hide"),e("#searchkeyword-nsr").val(""),e(".search-autocomplete").remove(),e(".sorteringsguiden").remove(),e(".vc_row").show(),e(".page-footer").show(),e(".main-container").removeAttr("style"),e(".search-fetchPlanner").html(""),e("body").hasClass("error404")&&e(".sidebar-footer-area").css("margin-top","0px")},t.prototype.fullScreen=function(t){return e(t.target).is("i")||e(t.target).is(".search-autocomplete")?void t.preventDefault():(e(".searchNSR input").focus(),e(".searchNSR").addClass("fullscreen"),event.stopPropagation(),e(".searchNSR").hasClass("position-relative")||(e(".closeSearch").removeClass("hide"),e("html, body").animate({scrollTop:0},"slow"),e(".vc_row").hide(),e(".page-footer").hide(),e(".searchNSR").closest(".vc_row").show(),e(".main-container").height(317),e(window).width()<540&&e(".main-container").height(237)),void(e("body").hasClass("error404")&&e(".sidebar-footer-area").css("margin-top","200px")))},t.prototype.fpTimer=function(){t.prototype.fetchPlannerQuery(e(".searchNSR"))},t.prototype.ElasticTimer=function(e){t.prototype.autocomplete(e)},t.prototype.doneTyping=function(){e(".searchNSR").each(function(e,n){clearTimeout(o),clearTimeout(a),o=setTimeout(function(){t.prototype.ElasticTimer(n)},300)}),a=setTimeout(t.prototype.fpTimer,1100)},t.prototype.autocomplete=function(t){var a=e(t),o=a.find('input[type="search"]');o.val().length<2||this.autocompleteQuery(t)},t.prototype.autocompleteSubmit=function(t){var a=e(t),o=a.find(".search-autocomplete"),n=o.find(".selected");return!n.length||(location.href=n.find("a").attr("href"),!1)},t.prototype.autocompleteQuery=function(a){var o=e(a),n=o.find('input[type="search"]').val(),r=e("#post_type").val(),s={action:"fetchDataFromElasticSearch",query:n,post_type:r,level:"ajax",type:"json"};t.prototype.getJsonData(o,s,r)},t.prototype.fetchPlannerQuery=function(a){var o=e(a),n=e("#searchkeyword-nsr").val(),r={action:"fetchDataFromFetchPlanner",query:n,level:"ajax",type:"json"};t.prototype.getJsonData(o,r,null)},t.prototype.spinner=function(){var e=arguments[0],t=arguments[1],a=arguments[2]?"block":"none";return t||(t="small"),'<div class="'+e+" preloader-wrapper "+t+' active" style="display:'+a+';"> <div class="spinner-layer spinner-white-only"> <div class="circle-clipper left"> <div class="circle"></div> </div><div class="gap-patch"> <div class="circle"></div> </div><div class="circle-clipper right"> <div class="circle"></div> </div> </div> </div> '},t.prototype.getJsonData=function(a,o,n){var r=t.prototype.spinner(t.prototype.hashCode(o.action),"big",!0);e.ajax({url:ajax_object.ajax_url,data:o,method:"GET",dataType:"json",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ajax_object.nonce),e(".searchNSR form .preloader-wrapper").length<1&&e(".searchNSR .searchArea").append(r),e("#searchkeyword-nsr").removeClass("valid"),e("#searchkeyword-nsr").removeClass("invalid"),e("#searchkeyword-nsr").addClass("waitingForConnection")}}).done(function(t){"fetchDataFromElasticSearch"===o.action?(e(".searchNSR").addClass("searchResult"),a.find(".sorteringsguiden").remove(),a.find(".search-autocomplete").remove(),this.outputAutocomplete(a,t,n)):(e(".search-fetchPlanner").html(""),this.outputFetchPlanner(a,t,!1),e(".searchArea .preloader-wrapper").remove(),e("#searchkeyword-nsr").hasClass("valid")&&e("#searchkeyword-nsr").addClass("valid"))}.bind(this))},t.prototype.metaDataStr=function(e){var t=new Array;switch(e){case"post":t.postSection="Nyheter",t.icon="chat";break;case"fastighet":t.postSection="Fastighetsägare & Bostadsrättsföreningar",t.icon="location_city";break;case"villa":t.postSection="Villa & Fritidsboende",t.icon="home";break;case"foretag":t.postSection="Företag & Restauranger",t.icon="domain";break;case"page":t.postSection="Sidor",t.icon="insert_drive_file";break;case"faq":t.postSection="Frågor & svar",t.icon="forum";break;case"sorteringsguide":t.postSection="Sorteringsguiden",t.icon="delete"}return""===t.icon&&(t.icon="find_in_page"),t},t.prototype.Strpos=function(e,t,a){var o=(e+"").indexOf(t,a||0);return o===-1?0:o},t.prototype.hashCode=function(e){var t=0;if(null===e)return t;for(i=0;i<e.length;i++)char=e.charCodeAt(i),t=(t<<5)-t+char,t&=t;return t},t.prototype.outputFetchPlanner=function(t,a){var o=(e(t),""),n="";if("undefined"!=typeof a.fp&&null!==a.fp&&a.fp.length>0){o+='<h4>Tömningsdagar</h4><table class="fp-table"><tr><th colspan="2">Adress</th><th>Udda/Jämn</th><th>Nästa tömningsdag</th></tr>',n+='<h4>Tömningsdagar</h4><table class="fp-table-mobile">';var r=(new Date).toISOString().slice(0,10),s=!1;console.log(a.fp),e.each(a.fp,function(t,a){e("#searchkeyword-nsr").removeClass("invalid"),e("#searchkeyword-nsr").addClass("valid"),a.hasOwnProperty("Exec")&&(a.Exec.AvfallsTyp[0]||a.Exec.AvfallsTyp[1])&&(e.inArray(!1,a.Exec.AvfallsTyp)<0&&(o+='<tr id="'+a.id+'">',o+='<td class="streetCiy"><strong>'+a.Adress+"</strong>",o+='<div><b class="">'+a.Ort+"</b></div>",o+="</td><td>",a.Exec.Datum[0]>=r&&a.Exec.AvfallsTyp[0]&&(o+='<span class="badge">'+a.Exec.AvfallsTyp[0]+"</span><br /> "),a.Exec.Datum[1]>=r&&a.Exec.AvfallsTyp[1]&&(o+='<span class="badge">'+a.Exec.AvfallsTyp[1]+"</span><br />"),a.Exec.Datum[2]>=r&&a.Exec.AvfallsTyp[2]&&(o+='<span class="badge">'+a.Exec.AvfallsTyp[2]+"</span><br /> "),o+="</td>",o+="</td>",o+="<td>",a.Exec.Datum[0]>=r&&(o+=a.Exec.DatumWeek[0]+"<br />"),a.Exec.Datum[1]>=r&&(o+=a.Exec.DatumWeek[1]+"<br />"),a.Exec.Datum[2]>=r&&(o+=a.Exec.DatumWeek[2]+"<br />"),o+="</td>",o+="<td>",a.Exec.Datum[0]>=r&&a.Exec.DatumFormaterat[0]&&(o+=a.Exec.DatumFormaterat[0]+"<br />"),a.Exec.Datum[1]>=r&&a.Exec.DatumFormaterat[1]&&(o+=a.Exec.DatumFormaterat[1]+"<br />"),a.Exec.Datum[2]>=r&&a.Exec.DatumFormaterat[2]&&(o+=a.Exec.DatumFormaterat[2]+"<br />")),o+="</td>",o+="</tr>"),s=!1}),o+="</table>"}e(".search-fetchPlanner").append(o),console.log(a)},t.prototype.outputAutocomplete=function(a,o,n){var r=e(a),i=e('<div class="search-autocomplete"></div>'),l=e('<ul class="search-autocomplete-content"></ul>'),c=e('<div class="sorteringsguiden"><h4>Sorteringsguiden</h4><div class="left badgeInfo"><span class="badge">P</span> Privat <span class="badge">F</span> Företag<br /></div></div>'),p=t.prototype.spinner(t.prototype.hashCode("elasticCords")),d=e('<table class="sorterings-guide-table"><tr class="tabDesk"><th></th><th>Sorteras som</th><th class="exnfodispl">Bra att veta</th><th class="relative">Lämnas nära dig</th></tr></table>'),h=!1,u=!1;if("undefined"!=typeof o.sortguide&&null!==o.sortguide&&o.sortguide.length>0){var m,f,g="",v="",y=0;e.each(o.sortguide,function(e,a){var o="";if(a.post_meta&&(a.post_meta.avfall_kundkategori[0].indexOf("foretag")>=0&&(o+='<span class="badge sortSectionIcon company">F</span>'),a.post_meta.avfall_kundkategori[0].indexOf("villa")>=0&&(o+='<span class="badge sortSectionIcon private">P</span> ')),m+='<tr class="tabMobile"><th>Avfall:</th><td valign="top">'+a.post_title+' <div class="badgecontainer">'+o+"</div></td></tr>",m+='<tr class="tabDesk"><td class="preSortCell" valign="top">'+a.post_title+' <div class="badgecontainer">'+o+'</div></td><td valign="top">',a.terms){if(""!=a.terms.fraktion_avc.name&&null!=a.terms.fraktion_avc.name){if(m+='<li><b>Återvinningscentral:</b><ul class="sortAs meta-fraktion">',g+="<li><b>ÅVC:</b><ul>",""!=a.terms.fraktion_avc.link)var n='<a href="'+a.terms.fraktion_avc.link+'">'+a.terms.fraktion_avc.name+"</a>";else var n=a.terms.fraktion_avc.name;m+='<li class="fraktion-icon">'+n+"</li>",g+='<li class="fraktion-icon">'+n+"<li>",m+="</ul></li>",g+="</ul></li>"}if(""!=a.terms.fraktion_hemma.name&&null!=a.terms.fraktion_hemma.name){if(m+='<li><b>Hemma:</b><ul class="meta-fraktion">',g+='<li><b class="sortAs">Hemma:</b><ul>',""!=a.terms.fraktion_hemma.link)var r='<a href="'+a.terms.fraktion_hemma.link+'">'+a.terms.fraktion_hemma.name+"</a>";else var r=a.terms.fraktion_hemma.name;m+='<li class="fraktion-icon">'+r+"</li>",g+='<li class="fraktion-icon">'+r+"<li>",m+="</ul></li>",g+="</ul></li>"}}m+="</td>";var i;a.post_meta&&(i=a.post_meta.avfall_bra_att_veta[0].replace(new RegExp("\r?\n","g"),"<br />")),m+='<td class="exnfodispl">'+i+"</td>",m+='<td valign="top">'+p+'<ul class="inlstallen">';var l="";if(a.terms&&a.terms.inlamningsstallen&&a.terms.inlamningsstallen.length){f=[];for(var c=0;c<a.terms.inlamningsstallen.length;c++){var d,u="",b="",k="";for(d=0;d<a.terms.inlamningsstallen[c].length;d++){var w="n"+t.prototype.hashCode(a.terms.inlamningsstallen[c][d].city)+"-"+c;a.terms.inlamningsstallen[c][d].pageurl&&(0===t.prototype.Strpos(a.terms.inlamningsstallen[c][d].pageurl,"?page_id=")?(b='<a href="'+a.terms.inlamningsstallen[c][d].pageurl+'">',k="</a>"):a.terms.inlamningsstallen[c][d].lat&&a.terms.inlamningsstallen[c][d]["long"]&&(u=' data-url="http://maps.google.com?q='+a.terms.inlamningsstallen[c][d].lat+","+a.terms.inlamningsstallen[c][d]["long"]+'" ')),f[c]=[a.terms.inlamningsstallen[c][d].city,a.terms.inlamningsstallen[c][d].lat,a.terms.inlamningsstallen[c][d]["long"],a.terms.inlamningsstallen[c][d].city,w],d>5&&(l="hide"),null!=a.terms.inlamningsstallen[c][d].city&&(m+='<li class="cord-'+w+" locationmap "+l+'" '+u+"> "+b+a.terms.inlamningsstallen[c][d].city+k+"</li>",v+='<li class="cord-'+w+" locationmap "+l+'" '+u+"> "+b+a.terms.inlamningsstallen[c][d].city+k+"</li>"),l=""}}s[y]=f,y++}m+="</ul></td>",m+="</tr>",m+='<tr class="tabMobile"><th>Sorteras:</th><td><ul class="meta-fraktion">'+g+"</ul></td></tr>",m+='<tr class="tabMobile"><th>Lämnas:</th><td>'+p+"<ul>"+v+"</ul></td></tr>",m+='<tr class="tabMobile lastchild"><td class="lastchild" colspan="2"> </td></tr>',g="",v="",a.post_title.length>0&&(h=!0)}),d.append(m)}t.prototype.metaDataStr("sorteringsguide");"undefined"!=typeof o.content&&null!==o.content&&o.content.length>0&&(e.each(o.content,function(e,a){var o=a.post_excerpt.replace(/^(.{180}[^\s]*).*/,"$1");o&&(o+="...");var n=t.prototype.metaDataStr(a.post_type);n.icon||(n.icon="find_in_page");var r='<li class="collapsible-header col s12 m12 l12"> <i class="material-icons"> '+n.icon+'</i><a href="'+a.guid+'">'+a.post_title+'<span class="section right">'+n.postSection+"</span>";o&&(r+='<div class="moreinfo">'+o+"</div>"),r+="</a></li>",l.append(r),u=!0}),e(".search-autocomplete").prepend("<h4>Sidor på nsr.se</h4>")),h&&(d.appendTo(c),c.appendTo(r)),u&&l.appendTo(i),i.appendTo(r).show(),e(".fraktion-icon").each(function(){e(this).find("span").hasClass("nofraktionlink")&&e(this).removeClass("fraktion-icon")}),u&&e(".search-autocomplete").prepend("<h4>Sidor på nsr.se</h4>"),u||h||(e("#searchkeyword-nsr").addClass("invalid"),e("#searchkeyword-nsr").removeClass("valid")),navigator.geolocation&&(e(".preloader-wrapper").fadeIn("slow"),navigator.geolocation.getCurrentPosition(t.prototype.UserLocation,t.prototype.GeoError))},t.prototype.GeoError=function(t){switch(t.code){case t.PERMISSION_DENIED:constant="PERMISSION_DENIED",e(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;case t.POSITION_UNAVAILABLE:constant="POSITION_UNAVAILABLE",e(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;case t.TIMEOUT:constant="TIMEOUT",e(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;default:constant="Unrecognized error",e(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant)}},t.prototype.UserLocation=function(e){t.prototype.NearestCity(e.coords.latitude,e.coords.longitude)},t.prototype.Deg2Rad=function(e){return e*Math.PI/180},t.prototype.PythagorasEquirectangular=function(e,a,o,n){e=t.prototype.Deg2Rad(e),o=t.prototype.Deg2Rad(o),a=t.prototype.Deg2Rad(a),n=t.prototype.Deg2Rad(n);var r=6371,s=(n-a)*Math.cos((e+o)/2),i=o-e,l=Math.sqrt(s*s+i*i)*r;return l},t.prototype.NearestCity=function(a,o){for(ind=0;ind<s.length;++ind)if(ind<s.length+1){e(l).closest("ul").addClass("parent-"+ind);var n,r=99999;for(index=0;index<s[ind].length;++index){var i=t.prototype.PythagorasEquirectangular(a,o,s[ind][index][1],s[ind][index][2]);if(i<r){n=ind,r=i;var l="cord-"+s[ind][index][4]}}e("."+l).addClass("geoLink"),e("."+l).removeClass("hide");var c=0;e(".inlstallen li ").each(function(){if(c>4&&e(this).addClass("hide"),e(this).hasClass(l)){var t=e(this).clone();e(this).parent().prepend(t),e(this).remove()}}),icn=!1,l=!1,e(l).parent().css("background","red")}return e(".preloader-wrapper").fadeOut("slow"),s[n]},t.prototype.getUrlParameter=function(e){var t,a,o=decodeURIComponent(window.location.search.substring(1)),n=o.split("&");for(a=0;a<n.length;a++)if(t=n[a].split("="),t[0]===e)return void 0===t[1]||t[1]},new t}(jQuery);