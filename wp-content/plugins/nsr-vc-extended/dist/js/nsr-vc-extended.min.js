var VcExtended=VcExtended||{};VcExtended.NSRExtend=VcExtended.NSRExtend||{},VcExtended.NSRExtend.Extended=function(t){function e(){this.init()}var a=null,n=200,o=[];return e.prototype.init=function(){e.prototype.DefaultSiteSearch(),t("body").hasClass("wp-admin")||t(".card-content").matchHeight(),t(function(){this.CollapsibleHeaders()}.bind(this)),t("body").on("click",".showAllPosts",function(){e.prototype.displayMore(this)}).bind(this),t("body").on("click",".searchArea *",function(t){e.prototype.fullScreen(t)}).bind(this),t("body").on("click",".closeSearch",function(t){e.prototype.closeScreen(this)}).bind(this),t.fn.enterKey=function(t){e.prototype.enterTrigger(t,this)},t(".searchNSR").enterKey(function(){event.preventDefault(),window.clearTimeout(a),e.prototype.doneTyping()}),t(".searchNSR").on("input",function(){window.clearTimeout(a),a=window.setTimeout(e.prototype.doneTyping,n)}),t(".searchNSR").on("keydown",function(t){e.prototype.haltTimer(t,a)}),t("body").on("click",".locationmap",function(){window.open(t(this).data("url"),"_blank")}).bind(this)},e.prototype.DefaultSiteSearch=function(){var a=e.prototype.getUrlParameter("q");a&&(t("#searchkeyword-nsr").focus(),t("#searchkeyword-nsr").val(a.replace(/\+/g," ")),e.prototype.doneTyping())},e.prototype.CollapsibleHeaders=function(){t("body").on("click",".collapsible-header",function(){$id=t(this).parents("ul").attr("id"),0===t(this).find("a").length?(t($id).find(".materialIconState").text("add"),t(this).hasClass("active")?t(this).find(".materialIconState").text("remove"):t(this).find(".materialIconState").text("add")):window.location.href=t(this).find("a").attr("href")}).bind(this)},e.prototype.encodeStr=function(t){return t.split("").reduce(function(t,e){return t=(t<<5)-t+e.charCodeAt(0),t&t},0)},e.prototype.displayMore=function(e){if(event.preventDefault(),t(e).closest("ul").find("li").hasClass("hide")){t(e).closest("ul").find(".hide").addClass("show"),t(e).closest("ul").find("li").removeClass("hide");var a=t(e).closest("ul").find("li").length-6;t(e).closest("ul").find(".showPosts").text("Dölj ("+a+")")}else{t(e).closest("ul").find(".show").addClass("hide"),t(e).closest("ul").find("li").removeClass("show");var n=t(e).closest("ul").find("li").length-1;t(e).closest("ul").find(".showPosts").text("Visa alla ("+n+")")}t(".card-content").matchHeight()},e.prototype.enterTrigger=function(e,a){return a.each(function(){t(a).keypress(function(n){var o=n.keyCode?n.keyCode:n.which;if("13"==o)return t(".search-autocomplete").remove(),t(".sorteringsguiden").remove(),e.call(a,n),event.preventDefault(),!1})})},e.prototype.haltTimer=function(t,e){switch(t.which){case 32:window.clearTimeout(e);break;case 8:window.clearTimeout(e)}},e.prototype.closeScreen=function(e){event.stopPropagation(),t(".searchNSR").removeClass("fullscreen"),t(".searchNSR").removeClass("searchResult"),t(e).addClass("hide"),t("#searchkeyword-nsr").val(""),t(".search-autocomplete").remove(),t(".sorteringsguiden").remove(),t(".vc_row").show(),t(".page-footer").show(),t(".main-container").removeAttr("style"),t("body").hasClass("error404")&&t(".sidebar-footer-area").css("margin-top","0px")},e.prototype.fullScreen=function(e){return t(e.target).is("i")||t(e.target).is(".search-autocomplete")?void e.preventDefault():(t(".searchNSR input").focus(),t(".searchNSR").addClass("fullscreen"),event.stopPropagation(),t(".searchNSR").hasClass("position-relative")||(t(".closeSearch").removeClass("hide"),t("html, body").animate({scrollTop:0},"slow"),t(".vc_row").hide(),t(".page-footer").hide(),t(".searchNSR").closest(".vc_row").show(),t(".main-container").height(317),t(window).width()<540&&t(".main-container").height(237)),void(t("body").hasClass("error404")&&t(".sidebar-footer-area").css("margin-top","200px")))},e.prototype.doneTyping=function(){t(".searchNSR").each(function(t,a){e.prototype.autocomplete(a)})},e.prototype.autocomplete=function(e){var a=t(e),n=a.find('input[type="search"]');n.val().length<2||this.autocompleteQuery(e)},e.prototype.autocompleteSubmit=function(e){var a=t(e),n=a.find(".search-autocomplete"),o=n.find(".selected");return!o.length||(location.href=o.find("a").attr("href"),!1)},e.prototype.autocompleteQuery=function(e){var a=t(e),n=a.find('input[type="search"]').val(),o=t("#post_type").val(),i={action:"fetch_data",query:n,post_type:o,level:"ajax",type:"json"};t.ajax({url:ajax_object.ajax_url,data:i,method:"GET",dataType:"json",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ajax_object.nonce)}}).done(function(n){t(".searchNSR").addClass("searchResult"),a.find(".sorteringsguiden").remove(),a.find(".search-autocomplete").remove(),this.outputAutocomplete(e,n,o)}.bind(this))},e.prototype.metaDataStr=function(t){var e=new Array;switch(t){case"post":e.postSection="Nyheter",e.icon="chat";break;case"fastighet":e.postSection="Fastighetsägare & Bostadsrättsföreningar",e.icon="location_city";break;case"villa":e.postSection="Villa & Fritidsboende",e.icon="home";break;case"foretag":e.postSection="Företag & Restauranger",e.icon="domain";break;case"page":e.postSection="Sidor",e.icon="insert_drive_file";break;case"faq":e.postSection="Frågor & svar",e.icon="forum";break;case"sorteringsguide":e.postSection="Sorteringsguiden",e.icon="delete"}return""===e.icon&&(e.icon="find_in_page"),e},e.prototype.Strpos=function(t,e,a){var n=(t+"").indexOf(e,a||0);return n===-1?0:n},e.prototype.outputAutocomplete=function(a,n,i){var s=t(a),r=t('<div class="search-autocomplete"></div>'),l=t('<ul class="search-autocomplete-content"></ul>'),c=t('<div class="sorteringsguiden"><h4>Sorteringsguiden</h4><div class="left badgeInfo"><span class="badge">P</span> Privat <span class="badge">F</span> Företag<br /></div></div>'),d='<div class="preloader-wrapper small active" style="display:none;"> <div class="spinner-layer spinner-white-only"> <div class="circle-clipper left"> <div class="circle"></div> </div><div class="gap-patch"> <div class="circle"></div> </div><div class="circle-clipper right"> <div class="circle"></div> </div> </div> </div> ',p=t('<table class="sorterings-guide-table"><tr class="tabDesk"><th></th><th>Sorteras som</th><th class="exnfodispl">Bra att veta</th><th class="relative">Lämnas nära dig</th></tr></table>'),h=!1,f=!1;if("undefined"!=typeof n.sortguide&&null!==n.sortguide&&n.sortguide.length>0){var u,m,g="",v="",y=0;t.each(n.sortguide,function(t,a){var n="";if(a.post_meta&&(a.post_meta.avfall_kundkategori[0].indexOf("foretag")>=0&&(n+='<span class="badge sortSectionIcon company">F</span>'),a.post_meta.avfall_kundkategori[0].indexOf("villa")>=0&&(n+='<span class="badge sortSectionIcon private">P</span> ')),u+='<tr class="tabMobile"><th>Avfall:</th><td valign="top">'+a.post_title+' <div class="badgecontainer">'+n+"</div></td></tr>",u+='<tr class="tabDesk"><td class="preSortCell" valign="top">'+a.post_title+' <div class="badgecontainer">'+n+'</div></td><td valign="top">',a.terms){if(a.post_meta.avfall_fraktion&&""!=a.post_meta.avfall_fraktion&&a.post_meta.avfall_fraktion.length&&""!=a.post_meta.avfall_fraktion){for(u+='<li><b>Återvinningscentral:</b><ul class="sortAs meta-fraktion">',g+="<li><b>ÅVC:</b><ul>",int=0;int<a.post_meta.avfall_fraktion.length;int++)u+='<li class="fraktion-icon">'+a.post_meta.avfall_fraktion[int]+"</li>",g+='<li class="fraktion-icon">'+a.post_meta.avfall_fraktion[int]+"<li>";u+="</ul></li>",g+="</ul></li>"}if(a.post_meta.avfall_fraktion_hemma&&""!=a.post_meta.avfall_fraktion_hemma&&a.post_meta.avfall_fraktion_hemma.length&&""!=a.post_meta.avfall_fraktion_hemma){for(u+='<li><b>Hemma:</b><ul class="meta-fraktion">',g+='<li><b class="sortAs">Hemma:</b><ul>',int=0;int<a.post_meta.avfall_fraktion_hemma.length;int++)u+='<li class="fraktion-icon">'+a.post_meta.avfall_fraktion_hemma[int]+"</li>",g+='<li class="fraktion-icon">'+a.post_meta.avfall_fraktion_hemma[int]+"<li>";u+="</ul></li>",g+="</ul></li>"}}u+="</td>";var i;a.post_meta&&(i=a.post_meta.avfall_bra_att_veta[0].replace(new RegExp("\r?\n","g"),"<br />")),u+='<td class="exnfodispl">'+i+"</td>",u+='<td valign="top">'+d+'<ul class="inlstallen">';var s="";if(a.terms&&a.terms.inlamningsstallen&&a.terms.inlamningsstallen.length){for(m=[],int=0;int<a.terms.inlamningsstallen.length;int++){var r=a.terms.inlamningsstallen[int].term_id+"-"+int,l="",c="",p="";a.terms.inlamningsstallen[int].pageurl&&(0===e.prototype.Strpos(a.terms.inlamningsstallen[int].pageurl,"?page_id=")?(c='<a href="'+a.terms.inlamningsstallen[int].pageurl+'">',p="</a>"):a.terms.inlamningsstallen[int].lat&&a.terms.inlamningsstallen[int]["long"]&&(l=' data-url="http://maps.google.com?q='+a.terms.inlamningsstallen[int].lat+","+a.terms.inlamningsstallen[int]["long"]+'" ')),m[int]=[a.terms.inlamningsstallen[int].city,a.terms.inlamningsstallen[int].lat,a.terms.inlamningsstallen[int]["long"],a.terms.inlamningsstallen[int].name,r],int>5&&(s="hide"),u+='<li class="cord-'+r+" locationmap "+s+'" '+l+"> "+c+a.terms.inlamningsstallen[int].name+p+"</li>",v+='<li class="cord-'+r+" locationmap "+s+'" '+l+"> "+c+a.terms.inlamningsstallen[int].name+p+"</li>",s=""}o[y]=m,y++}u+="</ul></td>",u+="</tr>",u+='<tr class="tabMobile"><th>Sorteras:</th><td><ul class="meta-fraktion">'+g+"</ul></td></tr>",u+='<tr class="tabMobile"><th>Lämnas:</th><td>'+d+"<ul>"+v+"</ul></td></tr>",u+='<tr class="tabMobile lastchild"><td class="lastchild" colspan="2"> </td></tr>',g="",v="",a.post_title.length>0&&(h=!0)}),p.append(u)}e.prototype.metaDataStr("sorteringsguide");"undefined"!=typeof n.content&&null!==n.content&&n.content.length>0&&(t.each(n.content,function(t,a){var n=a.post_excerpt.replace(/^(.{180}[^\s]*).*/,"$1");n&&(n+="...");var o=e.prototype.metaDataStr(a.post_type);o.icon||(o.icon="find_in_page");var i='<li class="collapsible-header col s12 m12 l12"> <i class="material-icons"> '+o.icon+'</i><a href="'+a.guid+'">'+a.post_title+'<span class="section right">'+o.postSection+"</span>";n&&(i+='<div class="moreinfo">'+n+"</div>"),i+="</a></li>",l.append(i),f=!0}),t(".search-autocomplete").prepend("<h4>Sidor på nsr.se</h4>")),h&&(p.appendTo(c),c.appendTo(s)),f&&l.appendTo(r),r.appendTo(s).show(),t(".fraktion-icon").each(function(){t(this).find("span").hasClass("nofraktionlink")&&t(this).removeClass("fraktion-icon")}),f&&t(".search-autocomplete").prepend("<h4>Sidor på nsr.se</h4>"),f||h||(t("#searchkeyword-nsr").addClass("invalid"),t("#searchkeyword-nsr").removeClass("valid")),navigator.geolocation&&(t(".preloader-wrapper").fadeIn("slow"),navigator.geolocation.getCurrentPosition(e.prototype.UserLocation,e.prototype.GeoError))},e.prototype.GeoError=function(e){switch(e.code){case e.PERMISSION_DENIED:constant="PERMISSION_DENIED",t(".spinner-layer").hide(),console.log("geoLocation: "+constant);break;case e.POSITION_UNAVAILABLE:constant="POSITION_UNAVAILABLE",t(".spinner-layer").hide(),console.log("geoLocation: "+constant);break;case e.TIMEOUT:constant="TIMEOUT",t(".spinner-layer").hide(),console.log("geoLocation: "+constant);break;default:constant="Unrecognized error",t(".spinner-layer").hide(),console.log("geoLocation: "+constant)}},e.prototype.UserLocation=function(t){e.prototype.NearestCity(t.coords.latitude,t.coords.longitude)},e.prototype.Deg2Rad=function(t){return t*Math.PI/180},e.prototype.PythagorasEquirectangular=function(t,a,n,o){t=e.prototype.Deg2Rad(t),n=e.prototype.Deg2Rad(n),a=e.prototype.Deg2Rad(a),o=e.prototype.Deg2Rad(o);var i=6371,s=(o-a)*Math.cos((t+n)/2),r=n-t,l=Math.sqrt(s*s+r*r)*i;return l},e.prototype.NearestCity=function(a,n){for(ind=0;ind<o.length;++ind)if(ind<o.length+1){t(l).closest("ul").addClass("parent-"+ind);var i,s=99999;for(index=0;index<o[ind].length;++index){var r=e.prototype.PythagorasEquirectangular(a,n,o[ind][index][1],o[ind][index][2]);if(r<s){i=ind,s=r;var l="cord-"+o[ind][index][4]}}t("."+l).addClass("geoLink"),t("."+l).removeClass("hide");var c=0;t(".inlstallen li ").each(function(){if(c>4&&t(this).addClass("hide"),t(this).hasClass(l)){var e=t(this).clone();t(this).parent().prepend(e),t(this).remove()}}),icn=!1,l=!1,t(l).parent().css("background","red")}return t(".preloader-wrapper").fadeOut("slow"),o[i]},e.prototype.getUrlParameter=function(t){var e,a,n=decodeURIComponent(window.location.search.substring(1)),o=n.split("&");for(a=0;a<o.length;a++)if(e=o[a].split("="),e[0]===t)return void 0===e[1]||e[1]},new e}(jQuery);