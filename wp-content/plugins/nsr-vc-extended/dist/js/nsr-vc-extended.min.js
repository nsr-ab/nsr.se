var VcExtended=VcExtended||{};VcExtended.NSRExtend=VcExtended.NSRExtend||{},VcExtended.NSRExtend.Extended=function(t){function e(){e.prototype.init()}var a,o,n=null,s=200,r=[];return e.prototype.init=function(){e.prototype.DefaultSiteSearch(),t("body").hasClass("wp-admin")||t(".card-content").matchHeight(),t(function(){this.CollapsibleHeaders()}.bind(this)),t("body").on("click",".showAllPosts",function(){e.prototype.displayMore(this)}).bind(this),t("body").on("click",".card",function(e){t(this).data("link")&&(window.location.href=t(this).data("link"))}).bind(this),t("body").on("click",".searchArea *",function(t){e.prototype.fullScreen(t)}).bind(this),t("body").on("click",".closeSearch",function(t){e.prototype.closeScreen(this)}).bind(this),t.fn.enterKey=function(t){e.prototype.enterTrigger(t,this)},t(".searchNSR").enterKey(function(){event.preventDefault(),window.clearTimeout(n),e.prototype.doneTyping()}),t(".searchNSR").on("input",function(){window.clearTimeout(n),n=window.setTimeout(e.prototype.doneTyping,s)}),t(".searchNSR").on("keydown",function(t){e.prototype.haltTimer(t,n)}),t("body").on("click",".locationmap",function(){t(this).data("url")&&window.open(t(this).data("url"),"_blank")}).bind(this),t("body").on("click","#searchkeyword-nsr",function(){t("#searchkeyword-nsr").focus()}).bind(this)},e.prototype.DefaultSiteSearch=function(){var a=e.prototype.getUrlParameter("q");a&&(t("#searchkeyword-nsr").focus(),t("#searchkeyword-nsr").val(a.replace(/\+/g," ")),e.prototype.doneTyping())},e.prototype.CollapsibleHeaders=function(){t("body").on("click",".collapsible-header",function(){$id=t(this).parents("ul").attr("id"),0===t(this).find("a").length?(t($id).find(".materialIconState").text("add"),t(this).hasClass("active")?t(this).find(".materialIconState").text("remove"):t(this).find(".materialIconState").text("add")):window.location.href=t(this).find("a").attr("href")}).bind(this)},e.prototype.encodeStr=function(t){return t.split("").reduce(function(t,e){return t=(t<<5)-t+e.charCodeAt(0),t&t},0)},e.prototype.displayMore=function(e){if(event.preventDefault(),t(e).closest("ul").find("li").hasClass("hide")){t(e).closest("ul").find(".hide").addClass("show"),t(e).closest("ul").find("li").removeClass("hide");var a=t(e).closest("ul").find("li").length-6;t(e).closest("ul").find(".showPosts").text("Dölj ("+a+")")}else{t(e).closest("ul").find(".show").addClass("hide"),t(e).closest("ul").find("li").removeClass("show");var o=t(e).closest("ul").find("li").length-1;t(e).closest("ul").find(".showPosts").text("Visa alla ("+o+")")}t(".card-content").matchHeight()},e.prototype.enterTrigger=function(e,a){return a.each(function(){t(a).keypress(function(o){var n=o.keyCode?o.keyCode:o.which;if("13"==n)return t(".search-autocomplete").remove(),t(".sorteringsguiden").remove(),e.call(a,o),event.preventDefault(),!1})})},e.prototype.haltTimer=function(t,e){switch(t.which){case 32:window.clearTimeout(e);break;case 8:window.clearTimeout(e)}},e.prototype.closeScreen=function(e){event.stopPropagation(),t(".searchNSR").removeClass("fullscreen"),t(".searchNSR").removeClass("searchResult"),t(e).addClass("hide"),t("#searchkeyword-nsr").val(""),t(".search-autocomplete").remove(),t(".sorteringsguiden").remove(),t(".vc_row").show(),t(".page-footer").show(),t(".main-container").removeAttr("style"),t(".search-fetchPlanner").html(""),t("body").hasClass("error404")&&t(".sidebar-footer-area").css("margin-top","0px"),t(".tooltip-info.static-tooltip").removeClass("tooltipAfter"),t(window).width()<540&&(t("#site-header").css("min-height","150px"),t(".desk-logo").show(),t(".mob .center").addClass("hide"))},e.prototype.fullScreen=function(e){return t(e.target).is("i")||t(e.target).is(".search-autocomplete")?void e.preventDefault():(t(".searchNSR input").focus(),t(".searchNSR").addClass("fullscreen"),e.stopPropagation(),t(".searchNSR").hasClass("position-relative")||(t(".tooltip-info.static-tooltip").addClass("tooltipAfter"),t(".closeSearch").removeClass("hide"),t("html, body").animate({scrollTop:0},"slow"),t(".vc_row").hide(),t(".page-footer").hide(),t(".searchNSR").closest(".vc_row").show(),t(".main-container").height(317),t(window).width()<540?(t(".main-container").height(237),t("#site-header").css("min-height","70px"),t(".desk-logo").hide(),t(".mob .center").removeClass("hide")):(t("#site-header").css("min-height","150px"),t(".desk-logo").show(),t(".mob .center").addClass("hide"))),void(t("body").hasClass("error404")&&t(".sidebar-footer-area").css("margin-top","200px")))},e.prototype.fpTimer=function(){e.prototype.fetchPlannerQuery(t(".searchNSR"))},e.prototype.ElasticTimer=function(t){e.prototype.autocomplete(t)},e.prototype.doneTyping=function(){t(".searchNSR").each(function(t,n){clearTimeout(o),clearTimeout(a),o=setTimeout(function(){e.prototype.ElasticTimer(n)},300)}),a=setTimeout(e.prototype.fpTimer,1100)},e.prototype.autocomplete=function(e){var a=t(e),o=a.find('input[type="search"]');o.val().length<2||this.autocompleteQuery(e)},e.prototype.autocompleteSubmit=function(e){var a=t(e),o=a.find(".search-autocomplete"),n=o.find(".selected");return!n.length||(location.href=n.find("a").attr("href"),!1)},e.prototype.autocompleteQuery=function(a){var o=t(a),n=o.find('input[type="search"]').val(),s=t("#post_type").val(),i={action:"fetchDataFromElasticSearch",query:n,post_type:s,level:"ajax",type:"json"};e.prototype.getJsonData(o,i,s)},e.prototype.fetchPlannerQuery=function(a){var o=t(a),n=t("#searchkeyword-nsr").val(),s={action:"fetchDataFromFetchPlanner",query:n,level:"ajax",type:"json"};e.prototype.getJsonData(o,s,null)},e.prototype.spinner=function(){var t=arguments[0],e=arguments[1],a=arguments[2]?"block":"none";return e||(e="small"),'<div class="'+t+" preloader-wrapper "+e+' active" style="display:'+a+';"> <div class="spinner-layer spinner-white-only"> <div class="circle-clipper left"> <div class="circle"></div> </div><div class="gap-patch"> <div class="circle"></div> </div><div class="circle-clipper right"> <div class="circle"></div> </div> </div> </div> '},e.prototype.getJsonData=function(a,o,n){var s=e.prototype.spinner(e.prototype.hashCode(o.action),"big",!0);t.ajax({url:ajax_object.ajax_url,data:o,method:"GET",dataType:"json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ajax_object.nonce),t(".searchNSR form .preloader-wrapper").length<1&&t(".searchNSR .searchArea").append(s),t("#searchkeyword-nsr").removeClass("valid"),t("#searchkeyword-nsr").removeClass("invalid"),t("#searchkeyword-nsr").addClass("waitingForConnection")}}).complete(function(){"fetchDataFromFetchPlanner"===o.action&&t(".searchArea .preloader-wrapper").remove()}).done(function(e){"fetchDataFromElasticSearch"===o.action?(t(".searchNSR").addClass("searchResult"),a.find(".sorteringsguiden").remove(),a.find(".search-autocomplete").remove(),this.outputAutocomplete(a,e,n)):(t(".search-fetchPlanner").html(""),this.outputFetchPlanner(e,!1),t("#searchkeyword-nsr").hasClass("valid")&&t("#searchkeyword-nsr").addClass("valid"))}.bind(this))},e.prototype.metaDataStr=function(t){var e=new Array;switch(t){case"post":e.postSection="Nyheter",e.icon="chat";break;case"fastighet":e.postSection="Fastighetsägare & Bostadsrättsföreningar",e.icon="location_city";break;case"villa":e.postSection="Villa & Privat",e.icon="home";break;case"foretag":e.postSection="Företag & Verksamheter",e.icon="domain";break;case"page":e.postSection="Sidor",e.icon="insert_drive_file";break;case"faq":e.postSection="Frågor & svar",e.icon="forum";break;case"sorteringsguide":e.postSection="Sorteringsguiden",e.icon="delete"}return""===e.icon&&(e.icon="find_in_page"),e},e.prototype.Strpos=function(t,e,a){var o=(t+"").indexOf(e,a||0);return o===-1?0:o},e.prototype.hashCode=function(t){var e=0;if(null===t)return e;for(i=0;i<t.length;i++)char=t.charCodeAt(i),e=(e<<5)-e+char,e&=e;return e},e.prototype.outputFetchPlanner=function(e){var a="",o="";if("undefined"!=typeof e.fp&&null!==e.fp&&e.fp.length>0){a+='<h4>Tömningsdagar</h4><table class="fp-table"><tr class="tabDesk"><th colspan="2">Adress</th><th>Nästa tömning</th></tr>',o+='<table class="fp-table-mobile">';var n=(new Date).toISOString().slice(0,10),s=!1;t.each(e.fp,function(e,i){var r=[],l="",c="";if(t("#searchkeyword-nsr").removeClass("invalid"),t("#searchkeyword-nsr").addClass("valid"),i.hasOwnProperty("Exec")&&(i.Exec.AvfallsTyp[0]||i.Exec.AvfallsTyp[1])){if(t.inArray(!1,i.Exec.AvfallsTyp)<0){a+='<tr id="'+i.id+'" class="tabDesk">',a+='<td class="streetCiy"><strong>'+i.Adress+"</strong>",a+='<div><b class="">'+i.Ort+"</b></div>",a+="</td><td>";for(var p=0;p<i.Exec.AvfallsTyp.length;p++)i.Exec.Datum[p]>=n&&!r.indexOf(i.Exec.AvfallsTyp[p]+" "+i.Exec.Datum[p])>-1&&(r.avfall=i.Exec.AvfallsTyp[p],l+='<span class="badge">'+i.Exec.AvfallsTyp[p]+"</span><br /> ",r.nDate=i.Exec.AvfallsTyp[p],c+=i.Exec.DatumFormaterat[p]+"<br />",r[p]=i.Exec.AvfallsTyp[p]+" "+i.Exec.Datum[p]);a+=l+"</td><td>"+c,o+='<tr class="fpthmob"><th colspan="2"><i class="material-icons">date_range</i> <span><strong> '+i.Adress+"</span>, <span>"+i.Ort+"</span></strong></th></tr>",o+="<tr><th>Kärl</th><th>Nästa tömning</th></tr>",o+="<tr><td>"+l+"</td><td>"+c+"</td></tr>"}a+="</td></tr>"}s=!1}),a+="</table>",o+="</table>"}t(".search-fetchPlanner").append(a),t(".search-fetchPlanner").append(o)},e.prototype.outputAutocomplete=function(a,o,n){var s=t(a),i=t('<div class="search-autocomplete"></div>'),l=t('<ul class="search-autocomplete-content"></ul>'),c=t('<div class="sorteringsguiden"><h4>Sorteringsguiden</h4><div class="left badgeInfo"><span class="badge">P</span> Privat <span class="badge">F</span> Företag<br /></div></div>'),p=e.prototype.spinner(e.prototype.hashCode("elasticCords")),d=t('<table class="sorterings-guide-table"><tr class="tabDesk"><th></th><th>Sorteras som</th><th class="exnfodispl">Bra att veta</th><th class="relative">Lämnas nära dig</th></tr></table>'),h=!1,m=!1;if("undefined"!=typeof o.sortguide&&null!==o.sortguide&&o.sortguide.length>0){var f,u,g="",v="",y=0;t.each(o.sortguide,function(t,a){var o="";if(a.post_meta&&(a.post_meta.avfall_kundkategori[0].indexOf("foretag")>=0&&(o+='<span class="badge sortSectionIcon company">F</span>'),a.post_meta.avfall_kundkategori[0].indexOf("villa")>=0&&(o+='<span class="badge sortSectionIcon private">P</span> ')),f+='<tr class="tabMobile"><th class="col s12">Avfall:</th><td valign="top col s12">'+a.post_title+' <div class="badgecontainer">'+o+"</div></td></tr>",f+='<tr class="tabDesk"><td class="preSortCell" valign="top">'+a.post_title+' <div class="badgecontainer">'+o+'</div></td><td valign="top">',a.post_meta){if(""!=a.post_meta.fraktion_avc.name&&null!=a.post_meta.fraktion_avc.name){if(f+='<li><b>Återvinningscentral:</b><ul class="sortAs meta-fraktion">',g+="<li><b>Återvinningscentral:<br /></b><ul>",""!=a.post_meta.fraktion_avc.link)var n='<a href="'+a.post_meta.fraktion_avc.link+'">'+a.post_meta.fraktion_avc.name+"</a>";else var n=a.post_meta.fraktion_avc.name;f+='<li class="fraktion-icon">'+n+"</li>",g+='<li class="fraktion-icon">'+n+"<li>",f+="</ul></li>",g+="</ul></li>"}if(""!=a.post_meta.fraktion_hemma.name&&null!=a.post_meta.fraktion_hemma.name){if(f+='<li><b>Hemma:</b><ul class="meta-fraktion">',g+='<li><b class="sortAs">Hemma:</b><ul>',""!=a.post_meta.fraktion_hemma.link)var s='<a href="'+a.post_meta.fraktion_hemma.link+'">'+a.post_meta.fraktion_hemma.name+"</a>";else var s=a.post_meta.fraktion_hemma.name;f+='<li class="fraktion-icon">'+s+"</li>",g+='<li class="fraktion-icon">'+s+"<li>",f+="</ul></li>",g+="</ul></li>"}}f+="</td>";var i;a.post_meta&&(i=a.post_meta.avfall_bra_att_veta[0].replace(new RegExp("\r?\n","g"),"<br />")),f+='<td class="exnfodispl">'+i+"</td>",f+='<td valign="top">'+p+'<ul class="inlstallen">';var l="";if(a.post_meta&&a.post_meta.inlamningsstallen&&a.post_meta.inlamningsstallen.length){u=[];for(var c=0;c<8;c++){var d,m,_="",b="",k="",w="",S="",x="",C="";for(d=0;d<a.post_meta.inlamningsstallen[c].length;d++)a.post_meta.inlamningsstallen[c][d].pageurl&&(b="",k="",m="",e.prototype.Strpos(a.post_meta.inlamningsstallen[c][d].pageurl,"?page_id=")&&(a.post_meta.inlamningsstallen[c][d].pageurl="",b="",k="",_="",m=""),""!=a.post_meta.inlamningsstallen[c][d].pageurl&&(b='<a href="'+a.post_meta.inlamningsstallen[c][d].pageurl+'">',k="</a>",m="locationmap"),a.post_meta.inlamningsstallen[c][d].lat&&a.post_meta.inlamningsstallen[c][d]["long"]&&(a.post_meta.inlamningsstallen[c][d].pageurl||(_=' data-url="http://maps.google.com?q='+a.post_meta.inlamningsstallen[c][d].lat+","+a.post_meta.inlamningsstallen[c][d]["long"]+'" ',m="locationmap"))),a.post_meta.inlamningsstallen[c][d].lat&&a.post_meta.inlamningsstallen[c][d]["long"]&&(w='data-lat="'+a.post_meta.inlamningsstallen[c][d].lat+'" data-long="'+a.post_meta.inlamningsstallen[c][d]["long"]+'"',S=e.prototype.hashCode("id_"+c+d+"_"+a.post_meta.inlamningsstallen[c][d].lat+a.post_meta.inlamningsstallen[c][d]["long"])),a.post_meta.inlamningsstallen[c][d].lat&&a.post_meta.inlamningsstallen[c][d]["long"]&&(u[d]=[a.post_meta.inlamningsstallen[c][d].city,a.post_meta.inlamningsstallen[c][d].lat,a.post_meta.inlamningsstallen[c][d]["long"],a.post_meta.inlamningsstallen[c][d].city,S]),x=S,S&&(S='id="'+S+'"'),S="",d>5&&(l="hide"),null!=a.post_meta.inlamningsstallen[c][d].city&&(b||(C="nullLink"),f+='<li searchid="'+x+'" '+S+" "+w+' class="'+C+" "+m+" "+l+'" '+_+"> "+b+a.post_meta.inlamningsstallen[c][d].city+k+"</li>",v+='<li searchid="'+x+'" '+S+" "+w+' class="'+C+" "+m+" "+l+'" '+_+"> "+b+a.post_meta.inlamningsstallen[c][d].city+k+"</li>"),nullLink="",m="",l="",_="",w="",S=""}r[y]=u,y++}f+='<li class="viewAllInlamning"><a href="/alla-inlamningsstallen/">Visa alla</a></li></ul></td>',f+="</tr>",f+='<tr class="tabMobile"><th class="col s12">Sorteras som:</th><td><ul class="meta-fraktion">'+g+"</ul></td></tr>",f+='<tr class="tabMobile lastchild"><th class="col s12">Lämnas:</th><td>'+p+'<ul class="inlstallen">'+v+'<li class="viewAllInlamning"><a href="/alla-inlamningsstallen/">Visa alla</a></li></ul></td></tr>',g="",v="",a.post_title.length>0&&(h=!0)}),d.append(f)}e.prototype.metaDataStr("sorteringsguide");"undefined"!=typeof o.content&&null!==o.content&&o.content.length>0&&(t.each(o.content,function(t,a){var o=a.post_excerpt.replace(/^(.{180}[^\s]*).*/,"$1");o&&(o+="...");var n=e.prototype.metaDataStr(a.post_type);n.icon||(n.icon="find_in_page");var s='<li class="collapsible-header col s12 m12 l12"> <i class="material-icons"> '+n.icon+'</i><a href="'+a.guid+'">'+a.post_title+'<span class="section right">'+n.postSection+"</span>";o&&(s+='<div class="moreinfo">'+o+"</div>"),s+="</a></li>",l.append(s),m=!0}),t(".search-autocomplete").prepend("<h4>Sidor på nsr.se</h4>")),h&&(d.appendTo(c),c.appendTo(s)),m&&l.appendTo(i),i.appendTo(s).show(),t(".fraktion-icon").each(function(){t(this).find("span").hasClass("nofraktionlink")&&t(this).removeClass("fraktion-icon")}),m&&t(".search-autocomplete").prepend("<h4>Sidor på nsr.se</h4>"),m||h||(t("#searchkeyword-nsr").addClass("invalid"),t("#searchkeyword-nsr").removeClass("valid")),navigator.geolocation&&(t(".search-autocomplete .preloader-wrapper").fadeIn("slow"),navigator.geolocation.getCurrentPosition(e.prototype.UserLocation,e.prototype.GeoError))},e.prototype.GeoError=function(e){switch(e.code){case e.PERMISSION_DENIED:constant="PERMISSION_DENIED",t(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;case e.POSITION_UNAVAILABLE:constant="POSITION_UNAVAILABLE",t(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;case e.TIMEOUT:constant="TIMEOUT",t(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;default:constant="Unrecognized error",t(".search-autocomplete .preloader-wrapper").hide(),console.log("geoLocation: "+constant)}},e.prototype.UserLocation=function(t){e.prototype.NearestCity(t.coords.latitude,t.coords.longitude)},e.prototype.Deg2Rad=function(t){return t*Math.PI/180},e.prototype.PythagorasEquirectangular=function(t,a,o,n){t=e.prototype.Deg2Rad(t),o=e.prototype.Deg2Rad(o),a=e.prototype.Deg2Rad(a),n=e.prototype.Deg2Rad(n);var s=6371,i=(n-a)*Math.cos((t+o)/2),r=o-t,l=Math.sqrt(i*i+r*r)*s;return l},e.prototype.getDistanceFromLatLonInKm=function(t,a,o,n){var s=6371,i=e.prototype.Deg2Rad(o-t),r=e.prototype.Deg2Rad(n-a),l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e.prototype.Deg2Rad(t))*Math.cos(e.prototype.Deg2Rad(o))*Math.sin(r/2)*Math.sin(r/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),p=s*c;return p},e.prototype.findClosest=function(){return arguments[0]instanceof Array&&(arguments=arguments[0]),Math.min.apply(Math,arguments)},e.prototype.NearestCity=function(a,o){console.log(a+" : "+o);var n=null;for(ind=0;ind<r.length;++ind)if(ind<r.length+1){var s,i=[];for(index=0;index<r[ind].length;++index)if(r[ind][index]){var l=e.prototype.getDistanceFromLatLonInKm(a,o,r[ind][index][1],r[ind][index][2]);i[index]=l,r[ind][index][3]=l}for(index=0;index<r[ind].length;++index)if(r[ind][index]){var c=e.prototype.findClosest(i);if(c===r[ind][index][3]){var n=r[ind][index][4],p=t('[searchid="'+n+'"]');t(p).each(function(){t(this).addClass("closeToHome")})}c=null}icn=!1}return t(".inlstallen").each(function(){var e=!1;t(this).find("li").each(function(){if(e)return void(t(this).hasClass("closeToHome")&&t(this).removeClass("closeToHome"));if(t(this).hasClass("closeToHome")){t(this).addClass("geoLink"),t(this).removeClass("hide");var a=t(this).clone();t(this).parent().prepend(a),t(this).remove(),e=!0}})}),t(".search-autocomplete .preloader-wrapper").fadeOut("slow"),r[s]},e.prototype.getUrlParameter=function(t){var e,a,o=decodeURIComponent(window.location.search.substring(1)),n=o.split("&");for(a=0;a<n.length;a++)if(e=n[a].split("="),e[0]===t)return void 0===e[1]||e[1]},new e}(jQuery);