var VcExtended=VcExtended||{};VcExtended.NSRExtend=VcExtended.NSRExtend||{},VcExtended.NSRExtend.Extended=function(e){function t(){t.prototype.init()}var a,n,o=null,s=[],r=!1,l=[],c=null;return t.prototype.init=function(){t.prototype.DefaultSiteSearch(),e("body").hasClass("wp-admin")||e(".card-content").matchHeight(),e(function(){this.CollapsibleHeaders()}.bind(this)),e("body").on("click",".showAllPosts",function(){t.prototype.displayMore(this)}).bind(this),e("body").on("click",".card",function(t){e(this).data("link")&&(window.location.href=e(this).data("link"))}).bind(this),e.fn.enterKey=function(e){t.prototype.enterTrigger(e,this)},e(".searchNSR").enterKey(function(){event.preventDefault(),window.clearTimeout(o),t.prototype.doneTyping()}),e(".searchNSR form").on("submit",function(e){return e.preventDefault(),window.clearTimeout(o),t.prototype.doneTyping(),!1}).bind(this),e(".searchNSR").on("input",function(){console.log("init 101"),window.clearTimeout(o),r||(e(".searchNSR .search-button").show(),r=!0)}),e(".searchNSR").on("keydown",function(e){t.prototype.haltTimer(e,o)}),e("body").on("click",".locationmap",function(){e(this).data("url")&&window.open(e(this).data("url"),"_blank")}).bind(this),e("body").on("click","#searchkeyword-nsr",function(){e("#searchkeyword-nsr").focus()}).bind(this),e("body").on("click",".nsr-elasticSearch-nav",function(){e(".search-nav li").removeClass("active"),e(this).addClass("active"),e(".searchView").addClass("hide"),e(".sorteringsguiden").removeClass("hide")}).bind(this),e("body").on("click",".nsr-page-nav",function(){e(".search-nav li").removeClass("active"),e(this).addClass("active"),e(".searchView").addClass("hide"),e(".search-autocomplete").removeClass("hide")}).bind(this),e("body").on("click",".nsr-fetchplanner-nav",function(){e(".search-nav li").removeClass("active"),e(this).addClass("active"),e(".searchView").addClass("hide"),e(".search-fetchPlanner").removeClass("hide")}).bind(this)},t.prototype.DefaultSiteSearch=function(){console.log("DefaultSiteSearch 136");var a=t.prototype.getUrlParameter("q");a&&(e(".searchNSR .search-button").show(),e("#searchkeyword-nsr").focus(),e("#searchkeyword-nsr").val(a.replace(/\+/g," ")),t.prototype.doneTyping())},t.prototype.CollapsibleHeaders=function(){console.log("CollapsibleHeader 156"),e("body").on("click",".collapsible-header",function(){$id=e(this).parents("ul").attr("id"),0===e(this).find("a").length?(e($id).find(".materialIconState").text("add"),e(this).hasClass("active")?e(this).find(".materialIconState").text("remove"):e(this).find(".materialIconState").text("add")):window.location.href=e(this).find("a").attr("href")}).bind(this)},t.prototype.encodeStr=function(e){return e.split("").reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0)},t.prototype.displayMore=function(t){if(console.log("display more 199"),event.preventDefault(),e(t).closest("ul").find("li").hasClass("hide")){e(t).closest("ul").find(".hide").addClass("show"),e(t).closest("ul").find("li").removeClass("hide");var a=e(t).closest("ul").find("li").length-6;e(t).closest("ul").find(".showPosts").text("Dölj ("+a+")")}else{e(t).closest("ul").find(".show").addClass("hide"),e(t).closest("ul").find("li").removeClass("show");var n=e(t).closest("ul").find("li").length-1;e(t).closest("ul").find(".showPosts").text("Visa alla ("+n+")")}e(".card-content").matchHeight()},t.prototype.enterTrigger=function(t,a){return console.log("enterTrigger"),a.each(function(){e(a).keypress(function(e){var n=e.keyCode?e.keyCode:e.which;if("13"==n)return t.call(a,e),event.preventDefault(),!1})})},t.prototype.haltTimer=function(t,a){switch(t.which){case 32:window.clearTimeout(a);break;case 8:window.clearTimeout(a)}e("body").hasClass("error404")&&e(".sidebar-footer-area").css("margin-top","200px")},t.prototype.fpTimer=function(){t.prototype.fetchPlannerQuery(e(".searchNSR"))},t.prototype.ElasticTimer=function(e){console.log("elasticTimer 342"),t.prototype.autocomplete(e)},t.prototype.doneTyping=function(){console.log("doneTyping 354"),e(".searchNSR").each(function(e,o){clearTimeout(n),clearTimeout(a),n=setTimeout(function(){t.prototype.ElasticTimer(o)},300)}),a=setTimeout(t.prototype.fpTimer,1100)},t.prototype.Strpos=function(e,t,a){var n=(e+"").indexOf(t,a||0);return n===-1?0:n},t.prototype.hashCode=function(e){var t=0;if(null===e)return t;for(i=0;i<e.length;i++)char=e.charCodeAt(i),t=(t<<5)-t+char,t&=t;return t},t.prototype.metaDataStr=function(e){var t=new Array;switch(e){case"post":t.postSection="Nyheter",t.icon="chat";break;case"fastighet":t.postSection="Fastighetsägare & Bostadsrättsföreningar",t.icon="location_city";break;case"villa":t.postSection="Villa & Privat",t.icon="home";break;case"foretag":t.postSection="Företag & Verksamheter",t.icon="domain";break;case"page":t.postSection="Sidor",t.icon="insert_drive_file";break;case"faq":t.postSection="Frågor & svar",t.icon="forum";break;case"sorteringsguide":t.postSection="Sorteringsguiden",t.icon="delete"}return""===t.icon&&(t.icon="find_in_page"),t},t.prototype.spinner=function(){var e=arguments[0],t=arguments[1],a=arguments[2]?"block":"none";return t||(t="small"),'<div class="'+e+" preloader-wrapper "+t+' active" style="display:'+a+';"> <div class="spinner-layer spinner-white-only"> <div class="circle-clipper left"> <div class="circle"></div> </div><div class="gap-patch"> <div class="circle"></div> </div><div class="circle-clipper right"> <div class="circle"></div> </div> </div> </div> '},t.prototype.autocomplete=function(t){console.log("autoccomplete 371");var a=e(t),n=a.find('input[type="search"]');n.val().length<2||this.autocompleteQuery(t)},t.prototype.pushQueryUrl=function(e,t,a){console.log("pushQueryURL 410")},t.prototype.autocompleteQuery=function(a){var n=e(a),o=n.find('input[type="search"]').val(),s=e("#post_type",n.find('input[type="search"]').parent()).val();t.prototype.pushQueryUrl(n,o,s);var r={action:"fetchDataFromElasticSearch",query:o,post_type:s,level:"ajax",type:"json"};t.prototype.getJsonData("elastic",n,r,s)},t.prototype.fetchPlannerQuery=function(a){var n=e(a),o=n.find('input[type="search"]').val(),s=e("#post_type",e("#searchkeyword-nsr").parent()).val(),r={action:"fetchDataFromFetchPlannerCombined",query:o,post_type:s,level:"ajax",type:"json"};t.prototype.getJsonData("fetchplanner",n,r,null)},t.prototype.getJsonData=function(t,a,n,o){e.ajax({url:ajax_object.ajax_url,data:n,method:"GET",dataType:"json",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ajax_object.nonce),e(".nsr-searchResult .preloader-wrapper").length<1&&e(".prefix").addClass("nsr-origamiLoader"),e("#searchkeyword-nsr").removeClass("valid"),e("#searchkeyword-nsr").removeClass("invalid"),e("#searchkeyword-nsr").addClass("waitingForConnection")}}).complete(function(){"fetchDataFromFetchPlanner"!==n.action&&"fetchDataFromFetchPlannerCombined"!==n.action||e(".nsr-searchResult .preloader-wrapper").remove()}).done(function(e){this.dataFromSource(t,a,n,o,e)}.bind(this))},t.prototype.dataFromSource=function(t,a,n,o,s){switch(e(".sorteringsguiden-data").html(""),e(".search-autocomplete-data").html(""),e("#nsr-searchResult").css("display","block"),e(".hero-search").hasClass("searchMenu")||(e(".searchMenu").find("ul").hasClass("search-nav")?"":e(".searchMenu").append('<ul class="search-nav"><li class="vc_col-sm-3 nsr-elasticSearch-nav active">Sorteringsguiden</li><li class="vc_col-sm-3 nsr-page-nav">Sidor</li><li class="vc_col-sm-3 nsr-fetchplanner-nav">Tömmingsdagar</li></ul>')),t){case"elastic":l.sortguide=s.sortguide.length,l.content=s.content.length,c=1;break;case"fetchplanner":l.fetchplanner=s.fp.length,c=2}switch(2==c&&($mostRelevance=l.indexOf(Math.max.apply(window,l))),"undefined"!=typeof s.sortguide&&null!==s.sortguide&&"undefined"!=typeof parent.ga?parent.ga("send","event","SiteSearch",n.action,n.query,s.sortguide.length):"","undefined"!=typeof s.content&&null!==s.content&&"undefined"!=typeof parent.ga?parent.ga("send","event","SiteSearch",n.action,n.query,s.content.length):"",this.outputAutocomplete(a,s),e(".search-fetchPlanner").html(""),"undefined"!=typeof s.fp&&null!==s.fp&&"undefined"!=typeof parent.ga?parent.ga("send","event","SiteSearch",n.action,n.query,s.fp.length):"",this.outputFetchPlanner(a,s),e("#searchkeyword-nsr").hasClass("valid")&&e("#searchkeyword-nsr").addClass("valid"),e(".prefix").removeClass("nsr-origamiLoader"),$mostRelevance){case"sortguide":e("sorteringsguiden-data").addClass("show");break;case"content":e(".search-autocomplete").addClass("show");break;case"fetchplanner":e(".search-fetchPlanner").addClass("show")}},t.prototype.outputAutocomplete=function(a,n){this.sortGuideResult(a,n),this.sortPagesResult(a,n),window.navigator.geolocation&&(e(".search-autocomplete-data .preloader-wrapper").fadeIn("slow"),window.navigator.geolocation.getCurrentPosition(t.prototype.UserLocation,t.prototype.GeoError)),e("#nsr-searchResult").removeClass("hide")},t.prototype.sortGuideResult=function(a,n){var o=t.prototype.spinner(t.prototype.hashCode("elasticCords"));if(e(".sorteringsguiden-data").append('<h4>Sorteringsguiden</h4><div class="left badgeInfo"></div>'),"undefined"!=typeof n.sortguide&&null!==n.sortguide&&n.sortguide.length>0){var r,i=null,l=null,c=0,p=null;e(".errorSortguide").is(":visible")&&e(".errorSortguide").addClass("hide"),p+="<table>",e.each(n.sortguide,function(e,a){if(a.post_meta){if(""!=a.post_meta.fraktion_avc.name&&null!=a.post_meta.fraktion_avc.name){if(p+='<li><b>Återvinningscentral:</b><ul class="sortAs meta-fraktion">',i+="<li><b>Återvinningscentral:<br /></b><ul>",""!=a.post_meta.fraktion_avc.link)var n='<a href="'+a.post_meta.fraktion_avc.link+'">'+a.post_meta.fraktion_avc.name+"</a>";else var n=a.post_meta.fraktion_avc.name;p+='<li class="fraktion-icon">'+n+"</li>",i+='<li class="fraktion-icon">'+n+"<li>",p+="</ul></li>",i+="</ul></li>"}if(""!=a.post_meta.fraktion_hemma.name&&null!=a.post_meta.fraktion_hemma.name){if(p+='<li><b>Hemma:</b><ul class="meta-fraktion">',i+='<li><b class="sortAs">Hemma:</b><ul>',""!=a.post_meta.fraktion_hemma.link)var d='<a href="'+a.post_meta.fraktion_hemma.link+'">'+a.post_meta.fraktion_hemma.name+"</a>";else var d=a.post_meta.fraktion_hemma.name;p+='<li class="fraktion-icon">'+d+"</li>",i+='<li class="fraktion-icon">'+d+"<li>",p+="</ul></li>",i+="</ul></li>"}}p+="</td>";var h="";a.post_meta&&a.post_meta.avfall_bra_att_veta&&a.post_meta.avfall_bra_att_veta.length>=1&&"undefined"!=typeof a.post_meta.avfall_bra_att_veta[0]&&(h=a.post_meta.avfall_bra_att_veta[0].replace(new RegExp("\r?\n","g"),"<br />")),p+='<td class="exnfodispl">'+h+"</td>",p+='<td valign="top">'+o+'<ul class="inlstallen">';var u="";if(a.post_meta&&a.post_meta.inlamningsstallen&&a.post_meta.inlamningsstallen.length){r=[];for(var f=0;f<a.post_meta.inlamningsstallen.length;f++){var m,g,v="",y="",_="",b="",w="",k="",C="";for(m=0;m<a.post_meta.inlamningsstallen[f].length;m++)m>5&&(u="hide"),a.post_meta.inlamningsstallen[f][m].pageurl&&(y="",_="",g="",t.prototype.Strpos(a.post_meta.inlamningsstallen[f][m].pageurl,"?page_id=")&&(a.post_meta.inlamningsstallen[f][m].pageurl="",y="",_="",v="",g=""),""!=a.post_meta.inlamningsstallen[f][m].pageurl&&(y='<a href="'+a.post_meta.inlamningsstallen[f][m].pageurl+'">',_="</a>",g="locationmap"),a.post_meta.inlamningsstallen[f][m].lat&&a.post_meta.inlamningsstallen[f][m]["long"]&&(a.post_meta.inlamningsstallen[f][m].pageurl||(v=' data-url="http://maps.google.com?q='+a.post_meta.inlamningsstallen[f][m].lat+","+a.post_meta.inlamningsstallen[f][m]["long"]+'" ',g="locationmap"))),a.post_meta.inlamningsstallen[f][m].lat&&a.post_meta.inlamningsstallen[f][m]["long"]&&(b='data-lat="'+a.post_meta.inlamningsstallen[f][m].lat+'" data-long="'+a.post_meta.inlamningsstallen[f][m]["long"]+'"',w=t.prototype.hashCode("id_"+f+m+"_"+a.post_meta.inlamningsstallen[f][m].lat+a.post_meta.inlamningsstallen[f][m]["long"])),a.post_meta.inlamningsstallen[f][m].lat&&a.post_meta.inlamningsstallen[f][m]["long"]&&(r[m]=[a.post_meta.inlamningsstallen[f][m].city,a.post_meta.inlamningsstallen[f][m].lat,a.post_meta.inlamningsstallen[f][m]["long"],a.post_meta.inlamningsstallen[f][m].city,w]),k=w,w&&(w='id="'+w+'"'),w="",null!=a.post_meta.inlamningsstallen[f][m].city&&(y||(C="nullLink"),p+='<li searchid="'+k+'" '+w+" "+b+' class="'+C+" "+g+" "+u+'" '+v+"> "+y+a.post_meta.inlamningsstallen[f][m].city+_+"</li>",l+='<li searchid="'+k+'" '+w+" "+b+' class="'+C+" "+g+" "+u+'" '+v+"> "+y+a.post_meta.inlamningsstallen[f][m].city+_+"</li>"),nullLink="",g="",u="",v="",b="",w=""}s[c]=r,c++,p+='<li class="viewAllInlamning"><a href="/alla-inlamningsstallen/">Visa alla</a></li>'}p+="</ul></td>",p+="</tr>",p+='<tr class="tabMobile"><th class="col s12">Sorteras som:</th><td><ul class="meta-fraktion">'+i+"</ul></td></tr>",p+='<tr class="tabMobile lastchild"><th class="col s12">Lämnas:</th><td>'+o+'<ul class="inlstallen">'+l+'<li class="viewAllInlamning"><a href="/alla-inlamningsstallen/">Visa alla</a></li></ul></td></tr>',i="",l=""}),p+="</table>",e(".sorteringsguiden-data").append(p),e(".sorteringsguiden").removeClass("hide")}if("undefined"!=typeof n.sortguide&&null!==n.sortguide&&0===n.sortguide.length){var d="";d+='<h4>Sorteringsguide</h4><br /><p class="noResult">Det blev ingen träff på "'+e("#searchkeyword-nsr").val()+'". Tipsa oss om avfall som vi kan lägga till här  ( <a href="https://nsr.se/sorteringsguiden">nsr.se/sorteringsguiden</a> )</p>',e(".sorteringsguiden-data").html(d)}t.prototype.metaDataStr("sorteringsguide")},t.prototype.sortPagesResult=function(a,n){t.prototype.spinner(t.prototype.hashCode("elasticCords"));if(e(".search-autocomplete-data").append("<h4>Sidor på nsr.se</h4>"),"undefined"!=typeof n.content&&null!==n.content&&n.content.length>0&&e.each(n.content,function(a,n){var o=n.post_excerpt.replace(/^(.{180}[^\s]*).*/,"$1");o&&(o+="...");var s=t.prototype.metaDataStr(n.post_type);s.icon||(s.icon="find_in_page");var r='<li class="collapsible-header col s12 m12 l12"> <i class="material-icons"> '+s.icon+'</i><a href="'+n.guid+'">'+n.post_title+'<span class="section right">'+s.postSection+"</span>";o&&(r+='<div class="moreinfo">'+o+"</div>"),r+="</a></li>",e(".search-autocomplete-data").append(r),noContent=!0}),"undefined"!=typeof n.content&&null!==n.content&&0===n.content.length){var o="";o+='<h4>Sidor på nsr.se</h4><br /><p class="noResult">Ingen träff på "'+e("#searchkeyword-nsr").val()+'".</p>',e(".search-autocomplete-data").html(o).removeClass("hide")}},t.prototype.outputFetchPlanner=function(t){var a="",n="",o=!1;if(console.log(t.fp),e(".search-fetchPlanner-data").append('<h4>Tömmningsdagar</h4><table class="fp-table-mobile"></table><table class="fp-table"><tr class="tabDesk"><th colspan="2">Adress</th><th>Nästa tömning</th></tr></table>'),"undefined"!=typeof t.fp&&null!==t.fp&&t.fp.length>0){var s=(new Date).toISOString().slice(0,10),r=!1;e.each(t.fp,function(t,i){var l=[],c="",p="";if(e("#searchkeyword-nsr").removeClass("invalid"),e("#searchkeyword-nsr").addClass("valid"),i.hasOwnProperty("Exec")&&(i.Exec.AvfallsTyp[0]||i.Exec.AvfallsTyp[1])){if(e.inArray(!1,i.Exec.AvfallsTyp)<0){o=!0;for(var d=0;d<i.Exec.AvfallsTyp.length;d++)i.Exec.Datum[d]>=s&&!l.indexOf(i.Exec.AvfallsTyp[d]+" "+i.Exec.Datum[d])>-1&&(l.avfall=i.Exec.AvfallsTyp[d],c+='<span class="badge">'+i.Exec.AvfallsTyp[d]+"</span><br /> ",l.nDate=i.Exec.AvfallsTyp[d],p+=i.Exec.DatumFormaterat[d]+"<br />",l[d]=i.Exec.AvfallsTyp[d]+" "+i.Exec.Datum[d]);a+='<tr id="'+i.id+'" class="tabDesk">',a+='<td class="streetCiy"><strong>'+i.Adress+"</strong>",a+='<div><b class="">'+i.Ort+"</b></div>",a+='</td><td style="padding-top:15px;">',a+=c+"</td><td>"+p,n+='<tr class="fpthmob"><th colspan="2"><i class="material-icons">date_range</i> <span><strong> '+i.Adress+"</span>, <span>"+i.Ort+"</span></strong></th></tr>",n+="<tr><th>Kärl</th><th>Nästa tömning</th></tr>",n+='<tr><td style="padding-top:15px;">'+c+"</td><td>"+p+"</td></tr>"}a+="</td></tr>"}r=!1}),a+="</table>",n+="</table>"}"undefined"!=typeof t.fp&&null!==t.fp?0!==t.fp.length&&o?e(".search-fetchPlanner").detach().insertBefore(".errorSortguide"):(a='<h4>Tömningsdagar</h4><br /><p class="noResult">Det blev ingen träff på "'+e("#searchkeyword-nsr").val()+'". Tömningsdagar finns även på <a style="color:#ffffff!important;" href="https://minasidor.nsr.se">minasidor.nsr.se</a></p>',e(".search-fetchPlanner").detach().insertAfter(".errorSortguide")):e(".search-fetchPlanner").detach().insertAfter(".errorSortguide"),e(".fp-table").append(a),e(".fp-table-mobile").append(n)},t.prototype.GeoError=function(t){switch(t.code){case t.PERMISSION_DENIED:constant="PERMISSION_DENIED",e(".search-autocomplete-data .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;case t.POSITION_UNAVAILABLE:constant="POSITION_UNAVAILABLE",e(".search-autocomplete-data .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;case t.TIMEOUT:constant="TIMEOUT",e(".search-autocomplete-data .preloader-wrapper").hide(),console.log("geoLocation: "+constant);break;default:constant="Unrecognized error",e(".search-autocomplete-data .preloader-wrapper").hide()}},t.prototype.UserLocation=function(e){t.prototype.NearestCity(e.coords.latitude,e.coords.longitude)},t.prototype.Deg2Rad=function(e){return e*Math.PI/180},t.prototype.PythagorasEquirectangular=function(e,a,n,o){e=t.prototype.Deg2Rad(e),n=t.prototype.Deg2Rad(n),a=t.prototype.Deg2Rad(a),o=t.prototype.Deg2Rad(o);var s=6371,r=(o-a)*Math.cos((e+n)/2),i=n-e,l=Math.sqrt(r*r+i*i)*s;return l},t.prototype.getDistanceFromLatLonInKm=function(e,a,n,o){var s=6371,r=t.prototype.Deg2Rad(n-e),i=t.prototype.Deg2Rad(o-a),l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t.prototype.Deg2Rad(e))*Math.cos(t.prototype.Deg2Rad(n))*Math.sin(i/2)*Math.sin(i/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),p=s*c;return p},t.prototype.findClosest=function(){return arguments[0]instanceof Array&&(arguments=arguments[0]),Math.min.apply(Math,arguments)},t.prototype.NearestCity=function(a,n){var o=null;for(ind=0;ind<s.length;++ind)if(ind<s.length+1){var r,i=[];for(index=0;index<s[ind].length;++index)if(s[ind][index]){var l=t.prototype.getDistanceFromLatLonInKm(a,n,s[ind][index][1],s[ind][index][2]);i[index]=l,s[ind][index][3]=l}for(index=0;index<s[ind].length;++index)if(s[ind][index]){var c=t.prototype.findClosest(i);if(c===s[ind][index][3]){var o=s[ind][index][4],p=e('[searchid="'+o+'"]');e(p).each(function(){e(this).addClass("closeToHome")})}c=null}icn=!1}return e(".inlstallen").each(function(){var t=!1;e(this).find("li").each(function(){if(t)return void(e(this).hasClass("closeToHome")&&e(this).removeClass("closeToHome"));if(e(this).hasClass("closeToHome")){e(this).addClass("geoLink"),e(this).removeClass("hide");var a=e(this).clone();e(this).parent().prepend(a),e(this).remove(),t=!0}})}),e(".search-autocomplete-data .preloader-wrapper").fadeOut("slow"),s[r]},t.prototype.getUrlParameter=function(e){var t,a,n=decodeURIComponent(window.location.search.substring(1)),o=n.split("&");for(a=0;a<o.length;a++)if(t=o[a].split("="),t[0]===e)return void 0===t[1]||t[1]},new t}(jQuery);